{"ast":null,"code":"import DirSharded from './dir-sharded.js';\nimport DirFlat from './dir-flat.js';\n/**\n * @typedef {import('./dir').default} Dir\n * @typedef {import('./types').ImporterOptions} ImporterOptions\n */\n\n/**\n * @param {Dir | null} child\n * @param {Dir} dir\n * @param {number} threshold\n * @param {ImporterOptions} options\n * @returns {Promise<DirSharded>}\n */\n\nasync function flatToShard(child, dir, threshold, options) {\n  let newDir = dir;\n\n  if (dir instanceof DirFlat && dir.directChildrenCount() >= threshold) {\n    newDir = await convertToShard(dir, options);\n  }\n\n  const parent = newDir.parent;\n\n  if (parent) {\n    if (newDir !== dir) {\n      if (child) {\n        child.parent = newDir;\n      }\n\n      if (!newDir.parentKey) {\n        throw new Error('No parent key found');\n      }\n\n      await parent.put(newDir.parentKey, newDir);\n    }\n\n    return flatToShard(newDir, parent, threshold, options);\n  } // @ts-ignore\n\n\n  return newDir;\n}\n/**\n * @param {DirFlat} oldDir\n * @param {ImporterOptions} options\n */\n\n\nasync function convertToShard(oldDir, options) {\n  const newDir = new DirSharded({\n    root: oldDir.root,\n    dir: true,\n    parent: oldDir.parent,\n    parentKey: oldDir.parentKey,\n    path: oldDir.path,\n    dirty: oldDir.dirty,\n    flat: false,\n    mtime: oldDir.mtime,\n    mode: oldDir.mode\n  }, options);\n\n  for await (const {\n    key,\n    child\n  } of oldDir.eachChildSeries()) {\n    await newDir.put(key, child);\n  }\n\n  return newDir;\n}\n\nexport default flatToShard;","map":{"version":3,"sources":["C:/Users/Akshay Mishra/OneDrive/Desktop/twitter-clone-dapp/node_modules/ipfs-unixfs-importer/src/flat-to-shard.js"],"names":["DirSharded","DirFlat","flatToShard","child","dir","threshold","options","newDir","directChildrenCount","convertToShard","parent","parentKey","Error","put","oldDir","root","path","dirty","flat","mtime","mode","key","eachChildSeries"],"mappings":"AAAA,OAAOA,UAAP,MAAuB,kBAAvB;AACA,OAAOC,OAAP,MAAoB,eAApB;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAeC,WAAf,CAA4BC,KAA5B,EAAmCC,GAAnC,EAAwCC,SAAxC,EAAmDC,OAAnD,EAA4D;AAC1D,MAAIC,MAAM,GAAGH,GAAb;;AAEA,MAAIA,GAAG,YAAYH,OAAf,IAA0BG,GAAG,CAACI,mBAAJ,MAA6BH,SAA3D,EAAsE;AACpEE,IAAAA,MAAM,GAAG,MAAME,cAAc,CAACL,GAAD,EAAME,OAAN,CAA7B;AACD;;AAED,QAAMI,MAAM,GAAGH,MAAM,CAACG,MAAtB;;AAEA,MAAIA,MAAJ,EAAY;AACV,QAAIH,MAAM,KAAKH,GAAf,EAAoB;AAClB,UAAID,KAAJ,EAAW;AACTA,QAAAA,KAAK,CAACO,MAAN,GAAeH,MAAf;AACD;;AAED,UAAI,CAACA,MAAM,CAACI,SAAZ,EAAuB;AACrB,cAAM,IAAIC,KAAJ,CAAU,qBAAV,CAAN;AACD;;AAED,YAAMF,MAAM,CAACG,GAAP,CAAWN,MAAM,CAACI,SAAlB,EAA6BJ,MAA7B,CAAN;AACD;;AAED,WAAOL,WAAW,CAACK,MAAD,EAASG,MAAT,EAAiBL,SAAjB,EAA4BC,OAA5B,CAAlB;AACD,GAvByD,CAyB1D;;;AACA,SAAOC,MAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,eAAeE,cAAf,CAA+BK,MAA/B,EAAuCR,OAAvC,EAAgD;AAC9C,QAAMC,MAAM,GAAG,IAAIP,UAAJ,CAAe;AAC5Be,IAAAA,IAAI,EAAED,MAAM,CAACC,IADe;AAE5BX,IAAAA,GAAG,EAAE,IAFuB;AAG5BM,IAAAA,MAAM,EAAEI,MAAM,CAACJ,MAHa;AAI5BC,IAAAA,SAAS,EAAEG,MAAM,CAACH,SAJU;AAK5BK,IAAAA,IAAI,EAAEF,MAAM,CAACE,IALe;AAM5BC,IAAAA,KAAK,EAAEH,MAAM,CAACG,KANc;AAO5BC,IAAAA,IAAI,EAAE,KAPsB;AAQ5BC,IAAAA,KAAK,EAAEL,MAAM,CAACK,KARc;AAS5BC,IAAAA,IAAI,EAAEN,MAAM,CAACM;AATe,GAAf,EAUZd,OAVY,CAAf;;AAYA,aAAW,MAAM;AAAEe,IAAAA,GAAF;AAAOlB,IAAAA;AAAP,GAAjB,IAAmCW,MAAM,CAACQ,eAAP,EAAnC,EAA6D;AAC3D,UAAMf,MAAM,CAACM,GAAP,CAAWQ,GAAX,EAAgBlB,KAAhB,CAAN;AACD;;AAED,SAAOI,MAAP;AACD;;AAED,eAAeL,WAAf","sourcesContent":["import DirSharded from './dir-sharded.js'\nimport DirFlat from './dir-flat.js'\n\n/**\n * @typedef {import('./dir').default} Dir\n * @typedef {import('./types').ImporterOptions} ImporterOptions\n */\n\n/**\n * @param {Dir | null} child\n * @param {Dir} dir\n * @param {number} threshold\n * @param {ImporterOptions} options\n * @returns {Promise<DirSharded>}\n */\nasync function flatToShard (child, dir, threshold, options) {\n  let newDir = dir\n\n  if (dir instanceof DirFlat && dir.directChildrenCount() >= threshold) {\n    newDir = await convertToShard(dir, options)\n  }\n\n  const parent = newDir.parent\n\n  if (parent) {\n    if (newDir !== dir) {\n      if (child) {\n        child.parent = newDir\n      }\n\n      if (!newDir.parentKey) {\n        throw new Error('No parent key found')\n      }\n\n      await parent.put(newDir.parentKey, newDir)\n    }\n\n    return flatToShard(newDir, parent, threshold, options)\n  }\n\n  // @ts-ignore\n  return newDir\n}\n\n/**\n * @param {DirFlat} oldDir\n * @param {ImporterOptions} options\n */\nasync function convertToShard (oldDir, options) {\n  const newDir = new DirSharded({\n    root: oldDir.root,\n    dir: true,\n    parent: oldDir.parent,\n    parentKey: oldDir.parentKey,\n    path: oldDir.path,\n    dirty: oldDir.dirty,\n    flat: false,\n    mtime: oldDir.mtime,\n    mode: oldDir.mode\n  }, options)\n\n  for await (const { key, child } of oldDir.eachChildSeries()) {\n    await newDir.put(key, child)\n  }\n\n  return newDir\n}\n\nexport default flatToShard\n"]},"metadata":{},"sourceType":"module"}